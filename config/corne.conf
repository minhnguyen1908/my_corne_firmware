# Cấu hình khử nhiễu phím
CONFIG_ZMK_KSCAN_DEBOUNCE_PRESS_MS=3
CONFIG_ZMK_KSCAN_DEBOUNCE_RELEASE_MS=3

# Cấu hình enconder
CONFIG_EC11=y
CONFIG_EC11_TRIGGER_GLOBAL_THREAD=y

# Cấu hình công suất phát BLE
CONFIG_BT_CTLR_TX_PWR_PLUS_8=y

# Khắc phục lỗi báo cáo pin trên Windows
CONFIG_BT_GATT_ENFORCE_SUBSCRIPTION=n

# --- TẮT SLEEP ---
CONFIG_ZMK_SLEEP=n

# Cấu hình màn hình OLED
CONFIG_ZMK_DISPLAY=y
CONFIG_ZMK_DISPLAY_WORK_QUEUE_DEDICATED=y

# Cấu hình đánh thức
CONFIG_ZMK_EXT_POWER=y
CONFIG_ZMK_USB=y

# Cấu hình ZMK Studio ("hot-fix")
CONFIG_ZMK_STUDIO=y
CONFIG_ZMK_STUDIO_LOCKING=n
CONFIG_ZMK_STUDIO_LOCK_ON_DISCONNECT=n

# Cấu hình đèn nền RGB
CONFIG_ZMK_RGB_UNDERGLOW=y
CONFIG_WS2812_STRIP=y
CONFIG_ZMK_RGB_UNDERGLOW_EFF_START=0
CONFIG_ZMK_RGB_UNDERGLOW_BRT_MAX=30
CONFIG_ZMK_RGB_UNDERGLOW_EXT_POWER=n

# Tự động tắt RGB khi idle
CONFIG_ZMK_RGB_UNDERGLOW_AUTO_OFF_IDLE=y

# Cải thiện ổn định kết nối BLE
CONFIG_BT_BUF_ACL_RX_SIZE=512
CONFIG_BT_CTLR_DATA_LENGTH_MAX=251

# Tối ưu hóa log
CONFIG_ZMK_USB_LOGGING=n

# Không xóa bond khi khởi động
CONFIG_ZMK_BLE_CLEAR_BONDS_ON_START=n

# --- Cấu hình OLED Widgets ---
CONFIG_ZMK_WIDGET_LAYER_STATUS=y
CONFIG_ZMK_WIDGET_BATTERY_STATUS=y
CONFIG_ZMK_WIDGET_OUTPUT_STATUS=y

# --- Mã C-Code cho OLED "Handsome" ---
# Đây là cách chính xác để thêm mã C vào ZMK
CONFIG_ZMK_DISPLAY_INIT_CUSTOM_DRIVER_CODE=" \
#include <zmk/display/widgets/layer_status.h> \n \
#include <zmk/display/widgets/battery.h> \n \
#include <zmk/display/widgets/output_status.h> \n \
\n \
static struct zmk_widget_layer_status layer_status_widget; \n \
static struct zmk_widget_battery battery_widget; \n \
static struct zmk_widget_output_status output_status_widget; \n \
\n \
lv_obj_t *zmk_display_get_status_screen(); \n \
\n \
int zmk_display_init(const struct device *dev) { \n \
    lv_obj_t *screen = zmk_display_get_status_screen(); \n \
    \n \
    zmk_widget_layer_status_init(&layer_status_widget, screen); \n \
    lv_obj_align(zmk_widget_layer_status_obj(&layer_status_widget), LV_ALIGN_TOP_LEFT, 0, 0); \n \
    \n \
    zmk_widget_output_status_init(&output_status_widget, screen); \n \
    lv_obj_align(zmk_widget_output_status_obj(&output_status_widget), LV_ALIGN_TOP_RIGHT, 0, 0); \n \
    \n \
    zmk_widget_battery_init(&battery_widget, screen); \n \
    lv_obj_align(zmk_widget_battery_obj(&battery_widget), LV_ALIGN_BOTTOM_RIGHT, 0, 0); \n \
    \n \
    return 0; \n \
} \
"
